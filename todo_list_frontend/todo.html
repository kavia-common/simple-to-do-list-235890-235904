<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>To‑Do List (Standalone)</title>
    <meta
      name="description"
      content="A simple standalone To‑Do List that saves tasks in your browser using localStorage."
    />
    <link rel="stylesheet" href="./todo.css" />
  </head>

  <body>
    <main class="app">
      <header>
        <h1>To‑Do List</h1>
        <p class="hint">
          Standalone HTML file.<br />
          Tip: Press <strong>Enter</strong> to add a task.
        </p>
      </header>

      <section class="card" aria-label="To-do list">
        <div class="toolbar">
          <form class="input" id="addForm" autocomplete="off">
            <label for="taskInput" class="sr-only" style="position: absolute; left: -9999px;"
              >New task</label
            >
            <input
              id="taskInput"
              type="text"
              name="task"
              placeholder="Add a new task…"
              maxlength="200"
              aria-label="Add a new task"
            />
            <button class="btn btn-primary" type="submit" id="addBtn">Add</button>
          </form>

          <button class="btn btn-ghost" type="button" id="clearCompletedBtn">
            Clear completed
          </button>
        </div>

        <div class="meta" aria-live="polite">
          <div class="left">
            <span class="pill"><span id="countText">0 tasks</span></span>
            <span class="pill"><code>localStorage</code> enabled</span>
          </div>
          <div class="right">
            <button class="btn btn-ghost" type="button" id="clearAllBtn">Clear all</button>
          </div>
        </div>

        <ul id="list" aria-label="Tasks"></ul>
        <div class="empty" id="emptyState" hidden>No tasks yet. Add one above.</div>
      </section>

      <footer>
        Data is stored locally in your browser (<code>localStorage</code>). No network calls.
      </footer>
    </main>

    <script>
      /**
       * Standalone To‑Do List:
       * - Add tasks
       * - Toggle complete / incomplete
       * - Delete tasks
       * - Persist in localStorage
       */

      const STORAGE_KEY = "todo_list_frontend__standalone_tasks_v1";

      /** @typedef {{ id: string, title: string, done: boolean, createdAt: number }} Task */

      /** @returns {Task[]} */
      function loadTasks() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return [];
          return parsed
            .filter((t) => t && typeof t.id === "string")
            .map((t) => ({
              id: String(t.id),
              title: typeof t.title === "string" ? t.title : "",
              done: Boolean(t.done),
              createdAt: typeof t.createdAt === "number" ? t.createdAt : Date.now(),
            }))
            .filter((t) => t.title.trim().length > 0);
        } catch {
          return [];
        }
      }

      /** @param {Task[]} tasks */
      function saveTasks(tasks) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      }

      /** @returns {string} */
      function uid() {
        // Good enough for a small local app: timestamp + random.
        return `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 10)}`;
      }

      /** @param {number} ms */
      function formatRelative(ms) {
        const delta = Date.now() - ms;
        const minutes = Math.floor(delta / 60000);
        if (minutes < 1) return "just now";
        if (minutes < 60) return `${minutes}m ago`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours}h ago`;
        const days = Math.floor(hours / 24);
        return `${days}d ago`;
      }

      const els = {
        addForm: document.getElementById("addForm"),
        taskInput: document.getElementById("taskInput"),
        list: document.getElementById("list"),
        empty: document.getElementById("emptyState"),
        countText: document.getElementById("countText"),
        clearAllBtn: document.getElementById("clearAllBtn"),
        clearCompletedBtn: document.getElementById("clearCompletedBtn"),
      };

      /** @type {Task[]} */
      let tasks = loadTasks();

      function render() {
        els.list.innerHTML = "";

        if (tasks.length === 0) {
          els.empty.hidden = false;
        } else {
          els.empty.hidden = true;
        }

        const remaining = tasks.filter((t) => !t.done).length;
        const total = tasks.length;
        els.countText.textContent =
          total === 1 ? "1 task" : `${total} tasks` + (total ? ` • ${remaining} left` : "");

        for (const task of tasks) {
          const li = document.createElement("li");
          li.className = "task";
          li.dataset.id = task.id;

          const check = document.createElement("button");
          check.type = "button";
          check.className = "check";
          check.setAttribute("aria-label", task.done ? "Mark as incomplete" : "Mark as complete");
          check.dataset.checked = task.done ? "true" : "false";
          check.innerHTML =
            '<svg viewBox="0 0 20 20" aria-hidden="true"><path d="M7.6 13.7 3.9 10a1 1 0 0 1 1.4-1.4l2.3 2.3 7-7a1 1 0 1 1 1.4 1.4l-7.7 7.7a1 1 0 0 1-1.4 0z"/></svg>';

          check.addEventListener("click", () => {
            tasks = tasks.map((t) => (t.id === task.id ? { ...t, done: !t.done } : t));
            saveTasks(tasks);
            render();
          });

          const label = document.createElement("div");
          label.className = "label";

          const title = document.createElement("div");
          title.className = "title" + (task.done ? " done" : "");
          title.textContent = task.title;

          const sub = document.createElement("div");
          sub.className = "sub";
          sub.textContent = `Added ${formatRelative(task.createdAt)}`;

          label.appendChild(title);
          label.appendChild(sub);

          const actions = document.createElement("div");
          actions.className = "actions";

          const del = document.createElement("button");
          del.type = "button";
          del.className = "btn btn-danger";
          del.textContent = "Delete";
          del.setAttribute("aria-label", `Delete task: ${task.title}`);

          del.addEventListener("click", () => {
            tasks = tasks.filter((t) => t.id !== task.id);
            saveTasks(tasks);
            render();
          });

          actions.appendChild(del);

          li.appendChild(check);
          li.appendChild(label);
          li.appendChild(actions);

          els.list.appendChild(li);
        }
      }

      els.addForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const value = els.taskInput.value.trim();
        if (!value) return;

        tasks = [
          {
            id: uid(),
            title: value,
            done: false,
            createdAt: Date.now(),
          },
          ...tasks,
        ];

        saveTasks(tasks);
        els.taskInput.value = "";
        els.taskInput.focus();
        render();
      });

      els.clearAllBtn.addEventListener("click", () => {
        tasks = [];
        saveTasks(tasks);
        render();
      });

      els.clearCompletedBtn.addEventListener("click", () => {
        tasks = tasks.filter((t) => !t.done);
        saveTasks(tasks);
        render();
      });

      render();
    </script>
  </body>
</html>
